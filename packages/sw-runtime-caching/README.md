# sw-runtime-caching

A service worker helper library that implements various runtime caching strategies.

## Installation

`npm install --save-dev sw-runtime-caching`

## Demo

Browse sample source code in the [demo directory](https://github.com/GoogleChrome/sw-helpers/tree/future-of-sw-tooling/packages/sw-runtime-caching/demo), or
[try it out](https://googlechrome.github.io/sw-helpers/sw-runtime-caching/demo/) directly.

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### sw-runtime-caching

[packages/sw-runtime-caching/src/index.js:22-22](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/index.js#L22-L22 "Source code on GitHub")

sw-runtime-caching Module

### CacheFirst

[packages/sw-runtime-caching/src/lib/cache-first.js:23-46](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/cache-first.js#L23-L46 "Source code on GitHub")

**Extends module:sw-runtime-caching.Handler**

### CacheOnly

[packages/sw-runtime-caching/src/lib/cache-only.js:23-43](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/cache-only.js#L23-L43 "Source code on GitHub")

**Extends module:sw-runtime-caching.Handler**

### defaultCacheName

[packages/sw-runtime-caching/src/lib/constants.js:25-25](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/constants.js#L25-L25 "Source code on GitHub")

The default cache name, used by RequestWrapper when there's no name provided.
It combines a constant prefix with the `registration.scope` value associated
with the current service worker, ensuring that multiple service workers used
on the same origin will have different default caches.

### Handler

[packages/sw-runtime-caching/src/lib/handler.js:24-57](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/handler.js#L24-L57 "Source code on GitHub")

This a base class meant to be extended by other classes that implement
specific request strategies.

### NetworkFirst

[packages/sw-runtime-caching/src/lib/network-first.js:23-52](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/network-first.js#L23-L52 "Source code on GitHub")

**Extends module:sw-runtime-caching.Handler**

### NetworkOnly

[packages/sw-runtime-caching/src/lib/network-only.js:23-42](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/network-only.js#L23-L42 "Source code on GitHub")

**Extends module:sw-runtime-caching.Handler**

### RequestWrapper

[packages/sw-runtime-caching/src/lib/request-wrapper.js:34-193](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/request-wrapper.js#L34-L193 "Source code on GitHub")

This class is used by the various subclasses of `Handler` to configure the
cache name and any desired request/cache behaviors.

It automatically triggers any registered behaviors at the appropriate time.
The current set of behavior callbacks, along with the parameters they're
given and when they're called, is:

-   `cacheDidUpdate({cacheName, oldResponse, newResponse})`: Called whenever
    a new entry is written to the cache.
-   `fetchDidFail({request})`: Called whenever a network request fails.
-   `requestWillFetch({request})`: Called prior to making a network request.

### StaleWhileRevalidate

[packages/sw-runtime-caching/src/lib/stale-while-revalidate.js:23-50](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/stale-while-revalidate.js#L23-L50 "Source code on GitHub")

**Extends module:sw-runtime-caching.Handler**

### CacheFirst.handle

[packages/sw-runtime-caching/src/lib/cache-first.js:35-45](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/cache-first.js#L35-L45 "Source code on GitHub")

An implementation of a [cache-first](https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#cache-falling-back-to-network)
request strategy.

**Parameters**

-   `input` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `input.event` **FetchEvent** The event that triggered the service
               worker's fetch handler.
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)**  (optional, default `{}`)
    -   `$0.event`  

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Response](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5)>** The response, either from the cache,
         or if that isn't available, from the network.

### CacheOnly.handle

[packages/sw-runtime-caching/src/lib/cache-only.js:38-42](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/cache-only.js#L38-L42 "Source code on GitHub")

An implementation of a [cache-only](https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#cache-only)
request strategy.

The advantage to using this vs. directly calling `caches.match()` is that
it will use the cache configuration and trigger the behaviors defined in
the underlying `RequestWrapper`.

**Parameters**

-   `input` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** An object wrapper for the underlying parameters.
    -   `input.event` **FetchEvent** The event that triggered the service
               worker's fetch handler.
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)**  (optional, default `{}`)
    -   `$0.event`  

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Response](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5)>** The response from the cache.

### constructor

[packages/sw-runtime-caching/src/lib/handler.js:32-38](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/handler.js#L32-L38 "Source code on GitHub")

**Parameters**

-   `input` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `input.requestWrapper` **\[[RequestWrapper](#requestwrapper)]** An optional `RequestWrapper`
               that is used to configure the cache name and request behaviors. If
               not provided, a new `RequestWrapper` using the
               [default cache name](#defaultCacheName) will be used.
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)**  (optional, default `{}`)
    -   `$0.requestWrapper`  

### handle

[packages/sw-runtime-caching/src/lib/handler.js:54-56](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/handler.js#L54-L56 "Source code on GitHub")

An abstract method that each subclass must implement.

**Parameters**

-   `input` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `input.event` **FetchEvent** The event that triggered the service
               worker's fetch handler.
    -   `input.params` **\[[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)]** Additional parameters that might be passed
               in to the method. If used in conjunction with the `Route` class,
               then the return value from the `match` function in `Route` will
               be passed in via this parameter.
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)**  (optional, default `{}`)
    -   `$0.event`  
    -   `$0.params`  

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Response](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5)>** A response, obtained from whichever strategy
        is implemented.

### NetworkFirst.handle

[packages/sw-runtime-caching/src/lib/network-first.js:35-51](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/network-first.js#L35-L51 "Source code on GitHub")

An implementation of a [network first](https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#network-falling-back-to-cache)
request strategy.

**Parameters**

-   `input` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** An object wrapper for the underlying parameters.
    -   `input.event` **FetchEvent** The event that triggered the service
               worker's fetch handler.
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)**  (optional, default `{}`)
    -   `$0.event`  

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Response](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5)>** The response from the network, or if that's
         not available, a previously cached response.

### NetworkOnly.handle

[packages/sw-runtime-caching/src/lib/network-only.js:37-41](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/network-only.js#L37-L41 "Source code on GitHub")

An implementation of a [network-only](https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#network-only)
request strategy.

The advantage to using this vs. directly calling `fetch()` is that it will
trigger the behaviors defined in the underlying `RequestWrapper`.

**Parameters**

-   `input` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** An object wrapper for the underlying parameters.
    -   `input.event` **FetchEvent** The event that triggered the service
               worker's fetch handler.
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)**  (optional, default `{}`)
    -   `$0.event`  

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Response](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5)>** The response from the network.

### constructor

[packages/sw-runtime-caching/src/lib/request-wrapper.js:47-82](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/request-wrapper.js#L47-L82 "Source code on GitHub")

**Parameters**

-   `cacheName` **\[[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)]** The name of the cache to use for Handlers that
           involve caching. If none is provided, a default name that uses the
           current service worker scope will be used.
-   `behaviors` **\[[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>]** Any behaviors that should be invoked.
-   `fetchOptions` **\[[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)]** Values passed along to the
           [`init`](https://developer.mozilla.org/en-US/docs/Web/API/GlobalFetch/fetch#Parameters)
           of all `fetch()` requests made by this wrapper.
-   `matchOptions` **\[[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)]** Values passed along to the
           [`options`](https://developer.mozilla.org/en-US/docs/Web/API/Cache/match#Parameters)
           of all cache `match()` requests made by this wrapper.
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)**  (optional, default `{}`)
    -   `$0.cacheName`  
    -   `$0.behaviors`  
    -   `$0.fetchOptions`  
    -   `$0.matchOptions`  

### getCache

[packages/sw-runtime-caching/src/lib/request-wrapper.js:87-92](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/request-wrapper.js#L87-L92 "Source code on GitHub")

Returns **Cache** The cache for this RequestWrapper.

### match

[packages/sw-runtime-caching/src/lib/request-wrapper.js:102-107](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/request-wrapper.js#L102-L107 "Source code on GitHub")

Wraps `cache.match()`, using the previously configured cache name and match
options.

**Parameters**

-   `input` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `input.request` **([Request](https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs/request) \| [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String))** The key for the cache lookup.
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `$0.request`  

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Response](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5)>** The cached response.

### fetch

[packages/sw-runtime-caching/src/lib/request-wrapper.js:117-129](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/request-wrapper.js#L117-L129 "Source code on GitHub")

Wraps `fetch()`, and calls any `fetchDidFail` callbacks from the
registered behaviors if the request fails.

**Parameters**

-   `input` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `input.request` **([Request](https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs/request) \| [string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String))** The request or URL to be fetched.
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `$0.request`  

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Response](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5)>** The network response.

### fetchAndCache

[packages/sw-runtime-caching/src/lib/request-wrapper.js:144-192](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/request-wrapper.js#L144-L192 "Source code on GitHub")

Combines both fetching and caching, using the previously configured options
and calling the appropriate behaviors.

By default, responses with a status of [2xx](https://fetch.spec.whatwg.org/#ok-status)
will be considered valid and cacheable, but this could be overridden by
configuring one or more behaviors that implement the `cacheWillUpdate`
lifecycle callback.

**Parameters**

-   `input` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `input.request` **[Request](https://developer.mozilla.org/en-US/Add-ons/SDK/High-Level_APIs/request)** 
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `$0.request`  

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Response](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5)>** The network response.

### StaleWhileRevalidate.handle

[packages/sw-runtime-caching/src/lib/stale-while-revalidate.js:38-49](https://github.com/GoogleChrome/sw-helpers/blob/5504f5454a124329ec6075addf848e3aeb815437/packages/sw-runtime-caching/src/lib/stale-while-revalidate.js#L38-L49 "Source code on GitHub")

An implementation of a [stale-while-revalidate](https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#stale-while-revalidate)
request strategy.

In addition to updating the appropriate caches, if will also trigger any
appropriate behaviors defined in the underlying `RequestWrapper`.

**Parameters**

-   `input` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** An object wrapper for the underlying parameters.
    -   `input.event` **FetchEvent** The event that triggered the service
               worker's fetch handler.
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)**  (optional, default `{}`)
    -   `$0.event`  

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Response](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5)>** The response from the cache, if present, or
         from the network if not.
